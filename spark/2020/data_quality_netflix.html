<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>
        An Approach To Data Quality For Netflix Personalization Systems - Tushar Chandra
      </title>
    <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  
  <meta name="theme-color" content="#000000" />
  <meta http-equiv="window-target" content="_top" />
  
  <meta name="description" content="Netflix ingests terabytes of data and billions of rows daily, and these are used for personalized recommendations both online and offline. How do they manage data quality? By lots and lots of quality checks early on.
" />
  <meta name="generator" content="Hugo 0.65.3 with theme pure" />
  <title>An Approach To Data Quality For Netflix Personalization Systems - Tushar Chandra</title>
  

  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/9.15.10/styles/github.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
  <meta property="og:title" content="An Approach To Data Quality For Netflix Personalization Systems" />
<meta property="og:description" content="Netflix ingests terabytes of data and billions of rows daily, and these are used for personalized recommendations both online and offline. How do they manage data quality? By lots and lots of quality checks early on." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/spark/2020/data_quality_netflix.html" />
<meta property="article:published_time" content="2020-06-25T16:00:00-05:00" />
<meta property="article:modified_time" content="2020-06-25T16:00:00-05:00" />
<meta itemprop="name" content="An Approach To Data Quality For Netflix Personalization Systems">
<meta itemprop="description" content="Netflix ingests terabytes of data and billions of rows daily, and these are used for personalized recommendations both online and offline. How do they manage data quality? By lots and lots of quality checks early on.">
<meta itemprop="datePublished" content="2020-06-25T16:00:00-05:00" />
<meta itemprop="dateModified" content="2020-06-25T16:00:00-05:00" />
<meta itemprop="wordCount" content="640">



<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="An Approach To Data Quality For Netflix Personalization Systems"/>
<meta name="twitter:description" content="Netflix ingests terabytes of data and billions of rows daily, and these are used for personalized recommendations both online and offline. How do they manage data quality? By lots and lots of quality checks early on."/>
</head>
  </head>
  

  <body class="main-center theme-blue" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader">
    
    <script 
      data-goatcounter="https://tusharc.goatcounter.com/count"
      async src="//gc.zgo.at/count.js">
    </script>

    <div class="slimContent">
      <div class="navbar-header">
        <div class="profile-block text-center">
          <a id="avatar" href="/">
            <img class="img-circle" src="/headshot.jpg" width="200" height="200">
          </a>
          <h2 id="name" class="hidden-xs hidden-sm"><b>Tushar Chandra</b></h2>
          <h3 id="title" class="hidden-xs hidden-sm hidden-md">Data Scientist</h3>
          <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Chicago, IL</small>
        </div>

        
        <nav id="mobile-navbar" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
          <ul class="mobile-nav">
              <a href="/">
                <li class="menu-item-home">
                    <i class="icon icon-home-fill"></i>
                  <span class="menu-title"><br>Home</span>
                </li>
              </a>
              <a href="/about">
                <li class="menu-item-about">
                    <i class="icon icon-cup-fill"></i>
                  <span class="menu-title"><br>About</span>
                </li>
              </a>
              <a href="/resume">
                <li class="menu-item-resume">
                    <i class="icon icon-file"></i>
                  <span class="menu-title"><br>Resume</span>
                </li>
              </a>
              <a href="/reading">
                <li class="menu-item-reading">
                    <i class="icon icon-shu-fill"></i>
                  <span class="menu-title"><br>Reading</span>
                </li>
              </a>
              <a href="/categories.html">
                <li class="menu-item-categories">
                    <i class="icon icon-folder-open"></i>
                  <span class="menu-title"><br>Categories</span>
                </li>
              </a>
              <a href="/posts.html">
                <li class="menu-item-archives">
                    <i class="icon icon-archives-fill"></i>
                  <span class="menu-title"><br>Archives</span>
                </li>
              </a>

          </ul>
        </nav>
      </div>
      <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
        <ul class="nav navbar-nav main-nav">
            <li class="menu-item menu-item-home">
                <a href="/">
                    <i class="icon icon-home-fill"></i>
                  <span class="menu-title">Home</span>
                </a>
            </li>
            <li class="menu-item menu-item-about">
                <a href="/about">
                    <i class="icon icon-cup-fill"></i>
                  <span class="menu-title">About</span>
                </a>
            </li>
            <li class="menu-item menu-item-resume">
                <a href="/resume">
                    <i class="icon icon-file"></i>
                  <span class="menu-title">Resume</span>
                </a>
            </li>
            <li class="menu-item menu-item-reading">
                <a href="/reading">
                    <i class="icon icon-shu-fill"></i>
                  <span class="menu-title">Reading</span>
                </a>
            </li>
            <li class="menu-item menu-item-categories">
                <a href="/categories.html">
                    <i class="icon icon-folder-open"></i>
                  <span class="menu-title">Categories</span>
                </a>
            </li>
            <li class="menu-item menu-item-archives">
                <a href="/posts.html">
                    <i class="icon icon-archives-fill"></i>
                  <span class="menu-title">Archives</span>
                </a>
            </li>

        </ul>
      </nav>
    </div>
  </header>
<aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <div class="widget">
    <h3 class="widget-title"> Categories</h3>
    <div class="widget-body">
        <ul class="category-list">
            <li class="category-list-item"><a href="/categories/books.html" class="category-list-link">books</a><span class="category-list-count">6</span></li>
            <li class="category-list-item"><a href="/categories/chi2020.html" class="category-list-link">chi2020</a><span class="category-list-count">19</span></li>
            <li class="category-list-item"><a href="/categories/general.html" class="category-list-link">general</a><span class="category-list-count">33</span></li>
            <li class="category-list-item"><a href="/categories/papers.html" class="category-list-link">papers</a><span class="category-list-count">46</span></li>
            <li class="category-list-item"><a href="/categories/projects.html" class="category-list-link">projects</a><span class="category-list-count">7</span></li>
            <li class="category-list-item"><a href="/categories/self.html" class="category-list-link">self</a><span class="category-list-count">3</span></li>
            <li class="category-list-item"><a href="/categories/spark.html" class="category-list-link">spark</a><span class="category-list-count">32</span></li>
            <li class="category-list-item"><a href="/categories/what-i-read.html" class="category-list-link">what-i-read</a><span class="category-list-count">28</span></li>
        </ul>
    </div>
</div>
<div class="widget">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget-body">
        <ul class="recent-post-list list-unstyled no-thumbnail">
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="/spark/2020/census_differential_privacy.html" class="title">Using Apache Spark And Differential Privacy For Protecting The Privacy Of The 2020 Census Respondents</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-06-26 14:00:00 -0500 CDT" itemprop="datePublished">2020-06-26</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="/spark/2020/follow_recommendations_linkedin.html" class="title">Scoring At Scale: Generating Follow Recommendations For Over 690 Million LinkedIn Members</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-06-26 13:30:00 -0500 CDT" itemprop="datePublished">2020-06-26</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="/spark/2020/generalized_seir_models.html" class="title">Generalized SEIR Model On Large Networks</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-06-26 13:00:00 -0500 CDT" itemprop="datePublished">2020-06-26</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="/spark/2020/automated_testing_undocumented_assumptions.html" class="title">Automated Testing For Protecting Data Pipelines from Undocumented Assumptions</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-06-26 12:30:00 -0500 CDT" itemprop="datePublished">2020-06-26</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="/spark/2020/democratizing_pyspark.html" class="title">Democratizing PySpark For Mobile Game Publishing</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-06-26 12:00:00 -0500 CDT" itemprop="datePublished">2020-06-26</time>
                    </p>
                </div>
            </li>
        </ul>
    </div>
</div>
  </div>
</aside>

    
    
<main class="main" role="main"><div class="content">
  <article id="-" class="article article-type-" itemscope
    itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      <h1 itemprop="name">
  <a
    class=""
    href="/spark/2020/data_quality_netflix.html"
    >An Approach To Data Quality For Netflix Personalization Systems</a
  >
</h1>

      <div class="article-meta">
        <span class="article-date">
  <i class="icon icon-calendar-check"></i>
<a href="/spark/2020/data_quality_netflix.html">
  <time datetime="2020-06-25 16:00:00 -0500 CDT" itemprop="datePublished">2020-06-25</time>
</a>
</span><span class="article-category">
  <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/spark.html"> spark, </a>
</span>

        
      </div>
    </div>
    <div class="article-entry marked-body js-toc-content" itemprop="articleBody">
      <p>Netflix ingests terabytes of data and billions of rows daily, and these are used for personalized recommendations both online and offline. How do they manage data quality? By lots and lots of quality checks early on.</p>
<p><strong>Speaker</strong>: Preetam Joshi &amp; Vivek Kaushal, both senior software engineers at Netflix</p>
<h2 id="one-of-netflixs-data-pipelines">(One of) Netflix&rsquo;s data pipelines</h2>
<p>The talk opened with a summary of how Netflix recommendations work: start with member data and video data, do online feature generation, compute recommendations, and serve one. The online features are also sent to a historical fact store, so they can generate features offline later to train models offline and recompute recommendations (e.g., for trying out better models or experimenting). The talk focuses on the historical fact store.</p>
<p>The historical fact store consists of logger &gt; ETL &gt; Hive &gt; query engine. It has 10 PB of data with hundreds of attributes, and 1 billion rows flow through the ETL pipeline daily. The data is used by a variety of models to enable personalization. Bad data is &hellip; bad, though.</p>
<p><strong>Drift</strong>: imagine you have a bug in the ETL pipeline, and you erroneously mark 10% of kids&rsquo; profiles as adult profiles; adults will start seeing more kids content, and then thumbs down-ing that content, which is bad. That is a subtle bug&mdash;you might not notice it immediately, but eventually it&rsquo;ll cause problems with recommendations.</p>
<p><strong>Drastic changes</strong>: you put 6 socks in the dryer, and suddenly 5 come out. They show an example of an attribute that was sending 600M rows daily, and then on April 29th it sent 150M. They got an alert, fixed it, and it was back to normal the next day.</p>
<p><strong>Under utilization</strong>: you have a lot of data coming in, but you don&rsquo;t use it for anything. I don&rsquo;t really understand why this is a problem.</p>
<p>These can be caused by two kinds of bugs&mdash;bugs in the source or bugs in the pipeline. Preetam continued with the <em>solutions</em> to these data quality issues.</p>
<h2 id="tackling-data-quality">Tackling data quality</h2>
<p>Their data quality architecture looks like:</p>
<ul>
<li>online feature generation, which goes into a historical fact store</li>
<li>data aggregations (in Spark) put info into an aggregated data store</li>
<li>the aggregated data store powers both automated monitoring/alerting and metrics/visualizations</li>
</ul>
<p>Consider example data, having info on the amount of time that a member plays a video in seconds. In this example, there were <code>null</code> play durations, but there was another computed column log(play duration) which &hellip; wasn&rsquo;t always null (due to default handling). Another example was a 1-billion second play time, which is longer than Netflix itself has existed.</p>
<p>Without any kind of data quality monitoring, we might not realize these are causing problems until training time (if we&rsquo;re lucky) or perhaps when debugging a prod issue.</p>
<p>In this case, they might aggregate the daily number of null plays or the 99th percentile of play durations and <em>automatically</em> monitor for outliers. You could compare metrics with historical data from the previous week, or overlay two histograms, and look for differences within each pair of distributions.</p>
<p><strong>Automatic distribution checks</strong>: imagine you have two datasets with thousands of attributes, and you want to compare the distributions of each attribute independently. You&rsquo;ll first prune the attributes using a statistical test (and they described the Kolmogorov-Smirnov test), then debug the differing ones once the list has been made tractable.</p>
<p>They described their automated monitoring, too; they can set thresholds for the number of nulls or the 99th percentile, then send pager alerts, dev alerts, etc., when real-time metrics exceed that threshold. The big wins were 15% cost saving (from detection of unused data&mdash;oh, that&rsquo;s why they do it!), 80% proactive detection of issues, and 99% validation during data migrations.</p>
<p>The takeaway from all of this is that <strong>managing data quality is obviously important, but managing it as early as possible is critical.</strong> Love it.</p>
    </div>
    <div class="article-footer">
    </div>
  </article>
</div><nav class="bar bar-footer clearfix" data-stick-bottom>
    <div class="bar-inner">
        <ul class="pager pull-left">
            <li class="prev">
                <a href="/spark/2020/bayesian_generative_models.html" title="Using Bayesian Generative Models With Apache Spark To Solve Entity Resolution Problems At Scale"><i
                        class="icon icon-angle-left"
                        aria-hidden="true"></i><span>&nbsp;&nbsp;Older</span></a>
            </li>
            <li class="next">
                <a href="/spark/2020/clinical_decision_support_roche.html"
                    title="Automated And Explainable Deep Learning For Clinical Language Understanding At Roche"><span>Newer&nbsp;&nbsp;</span><i
                        class="icon icon-angle-right" aria-hidden="true"></i></a>
            </li>
        </ul>
    </div>
</nav>


</main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
<ul class="social-links">
    <li><a href="https://github.com/tuchandra" target="_blank" title="github" data-toggle=tooltip data-placement=top >
            <i class="icon icon-github"></i></a></li>
    <li><a href="https://www.linkedin.com/in/tushar-chandra-76a623b6/" target="_blank" title="linkedin" data-toggle=tooltip data-placement=top >
            <i class="icon icon-linkedin"></i></a></li>
    <li><a href="/index.xml" target="_blank" title="rss" data-toggle=tooltip data-placement=top >
            <i class="icon icon-rss"></i></a></li>
</ul>
  <div class="copyright">
    &copy; 2019 - 2020 Tushar Chandra
    <p style="margin-bottom: 4px">All opinions are my own.</p>
    <div class="publishby">
        Theme: <a href="https://github.com/xiaoheiAh/hugo-theme-pure" target="_blank">Hugo Pure</a>.
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
            showMathMenu: false, //disables context menu
            tex2jax: {
            inlineMath: [ ['$','$'], ['\\(','\\)'] ]
           }
    });
</script>


<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/highlight.min.js"></script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/languages/python.min.js"></script><script>
    hljs.configure({
        tabReplace: '    ', 
        classPrefix: ''     
        
    })
    hljs.initHighlightingOnLoad();
</script>

  </body>
</html>
