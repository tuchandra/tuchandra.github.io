<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>
        Scoring At Scale: Generating Follow Recommendations For Over 690 Million LinkedIn Members - Tushar Chandra
      </title>
    <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  
  <meta name="theme-color" content="#000000" />
  <meta http-equiv="window-target" content="_top" />
  
  <meta name="description" content="How does LinkedIn generate follow recommendations for hundreds of millions of users and entities? Anything involving large shuffles is a non-starter; this talk describes how they developed a custom hash-partitioned join algorithm to handle such large data.
" />
  <meta name="generator" content="Hugo 0.65.3 with theme pure" />
  <title>Scoring At Scale: Generating Follow Recommendations For Over 690 Million LinkedIn Members - Tushar Chandra</title>
  

  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/9.15.10/styles/github.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
  <meta property="og:title" content="Scoring At Scale: Generating Follow Recommendations For Over 690 Million LinkedIn Members" />
<meta property="og:description" content="How does LinkedIn generate follow recommendations for hundreds of millions of users and entities? Anything involving large shuffles is a non-starter; this talk describes how they developed a custom hash-partitioned join algorithm to handle such large data." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/spark/2020/follow_recommendations_linkedin.html" />
<meta property="article:published_time" content="2020-06-26T13:30:00-05:00" />
<meta property="article:modified_time" content="2020-06-26T13:30:00-05:00" />
<meta itemprop="name" content="Scoring At Scale: Generating Follow Recommendations For Over 690 Million LinkedIn Members">
<meta itemprop="description" content="How does LinkedIn generate follow recommendations for hundreds of millions of users and entities? Anything involving large shuffles is a non-starter; this talk describes how they developed a custom hash-partitioned join algorithm to handle such large data.">
<meta itemprop="datePublished" content="2020-06-26T13:30:00-05:00" />
<meta itemprop="dateModified" content="2020-06-26T13:30:00-05:00" />
<meta itemprop="wordCount" content="631">



<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Scoring At Scale: Generating Follow Recommendations For Over 690 Million LinkedIn Members"/>
<meta name="twitter:description" content="How does LinkedIn generate follow recommendations for hundreds of millions of users and entities? Anything involving large shuffles is a non-starter; this talk describes how they developed a custom hash-partitioned join algorithm to handle such large data."/>
</head>
  </head>
  

  <body class="main-center theme-blue" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader">
    
    <script 
      data-goatcounter="https://tusharc.goatcounter.com/count"
      async src="//gc.zgo.at/count.js">
    </script>

    <div class="slimContent">
      <div class="navbar-header">
        <div class="profile-block text-center">
          <a id="avatar" href="/">
            <img class="img-circle" src="/headshot.jpg" width="200" height="200">
          </a>
          <h2 id="name" class="hidden-xs hidden-sm"><b>Tushar Chandra</b></h2>
          <h3 id="title" class="hidden-xs hidden-sm hidden-md">Data Scientist</h3>
          <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Chicago, IL</small>
        </div>

        
        <nav id="mobile-navbar" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
          <ul class="mobile-nav">
              <a href="/">
                <li class="menu-item-home">
                    <i class="icon icon-home-fill"></i>
                  <span class="menu-title"><br>Home</span>
                </li>
              </a>
              <a href="/about">
                <li class="menu-item-about">
                    <i class="icon icon-cup-fill"></i>
                  <span class="menu-title"><br>About</span>
                </li>
              </a>
              <a href="/resume">
                <li class="menu-item-resume">
                    <i class="icon icon-file"></i>
                  <span class="menu-title"><br>Resume</span>
                </li>
              </a>
              <a href="/reading">
                <li class="menu-item-reading">
                    <i class="icon icon-shu-fill"></i>
                  <span class="menu-title"><br>Reading</span>
                </li>
              </a>
              <a href="/categories.html">
                <li class="menu-item-categories">
                    <i class="icon icon-folder-open"></i>
                  <span class="menu-title"><br>Categories</span>
                </li>
              </a>
              <a href="/posts.html">
                <li class="menu-item-archives">
                    <i class="icon icon-archives-fill"></i>
                  <span class="menu-title"><br>Archives</span>
                </li>
              </a>

          </ul>
        </nav>
      </div>
      <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
        <ul class="nav navbar-nav main-nav">
            <li class="menu-item menu-item-home">
                <a href="/">
                    <i class="icon icon-home-fill"></i>
                  <span class="menu-title">Home</span>
                </a>
            </li>
            <li class="menu-item menu-item-about">
                <a href="/about">
                    <i class="icon icon-cup-fill"></i>
                  <span class="menu-title">About</span>
                </a>
            </li>
            <li class="menu-item menu-item-resume">
                <a href="/resume">
                    <i class="icon icon-file"></i>
                  <span class="menu-title">Resume</span>
                </a>
            </li>
            <li class="menu-item menu-item-reading">
                <a href="/reading">
                    <i class="icon icon-shu-fill"></i>
                  <span class="menu-title">Reading</span>
                </a>
            </li>
            <li class="menu-item menu-item-categories">
                <a href="/categories.html">
                    <i class="icon icon-folder-open"></i>
                  <span class="menu-title">Categories</span>
                </a>
            </li>
            <li class="menu-item menu-item-archives">
                <a href="/posts.html">
                    <i class="icon icon-archives-fill"></i>
                  <span class="menu-title">Archives</span>
                </a>
            </li>

        </ul>
      </nav>
    </div>
  </header>
<aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <div class="widget">
    <h3 class="widget-title"> Categories</h3>
    <div class="widget-body">
        <ul class="category-list">
            <li class="category-list-item"><a href="/categories/books.html" class="category-list-link">books</a><span class="category-list-count">6</span></li>
            <li class="category-list-item"><a href="/categories/chi2020.html" class="category-list-link">chi2020</a><span class="category-list-count">19</span></li>
            <li class="category-list-item"><a href="/categories/general.html" class="category-list-link">general</a><span class="category-list-count">33</span></li>
            <li class="category-list-item"><a href="/categories/papers.html" class="category-list-link">papers</a><span class="category-list-count">46</span></li>
            <li class="category-list-item"><a href="/categories/projects.html" class="category-list-link">projects</a><span class="category-list-count">7</span></li>
            <li class="category-list-item"><a href="/categories/self.html" class="category-list-link">self</a><span class="category-list-count">3</span></li>
            <li class="category-list-item"><a href="/categories/spark.html" class="category-list-link">spark</a><span class="category-list-count">32</span></li>
            <li class="category-list-item"><a href="/categories/what-i-read.html" class="category-list-link">what-i-read</a><span class="category-list-count">28</span></li>
        </ul>
    </div>
</div>
<div class="widget">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget-body">
        <ul class="recent-post-list list-unstyled no-thumbnail">
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="/spark/2020/census_differential_privacy.html" class="title">Using Apache Spark And Differential Privacy For Protecting The Privacy Of The 2020 Census Respondents</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-06-26 14:00:00 -0500 CDT" itemprop="datePublished">2020-06-26</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="/spark/2020/follow_recommendations_linkedin.html" class="title">Scoring At Scale: Generating Follow Recommendations For Over 690 Million LinkedIn Members</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-06-26 13:30:00 -0500 CDT" itemprop="datePublished">2020-06-26</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="/spark/2020/generalized_seir_models.html" class="title">Generalized SEIR Model On Large Networks</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-06-26 13:00:00 -0500 CDT" itemprop="datePublished">2020-06-26</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="/spark/2020/automated_testing_undocumented_assumptions.html" class="title">Automated Testing For Protecting Data Pipelines from Undocumented Assumptions</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-06-26 12:30:00 -0500 CDT" itemprop="datePublished">2020-06-26</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="/spark/2020/democratizing_pyspark.html" class="title">Democratizing PySpark For Mobile Game Publishing</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-06-26 12:00:00 -0500 CDT" itemprop="datePublished">2020-06-26</time>
                    </p>
                </div>
            </li>
        </ul>
    </div>
</div>
  </div>
</aside>

    
    
<main class="main" role="main"><div class="content">
  <article id="-" class="article article-type-" itemscope
    itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      <h1 itemprop="name">
  <a
    class=""
    href="/spark/2020/follow_recommendations_linkedin.html"
    >Scoring At Scale: Generating Follow Recommendations For Over 690 Million LinkedIn Members</a
  >
</h1>

      <div class="article-meta">
        <span class="article-date">
  <i class="icon icon-calendar-check"></i>
<a href="/spark/2020/follow_recommendations_linkedin.html">
  <time datetime="2020-06-26 13:30:00 -0500 CDT" itemprop="datePublished">2020-06-26</time>
</a>
</span><span class="article-category">
  <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/spark.html"> spark, </a>
</span>

        
      </div>
    </div>
    <div class="article-entry marked-body js-toc-content" itemprop="articleBody">
      <p>How does LinkedIn generate follow recommendations for hundreds of millions of users and entities? Anything involving large shuffles is a non-starter; this talk describes how they developed a custom hash-partitioned join algorithm to handle such large data.</p>
<p><strong>Speakers</strong>: Emilie de Longueau (Senior SWE) and Abdulla Al-Qawasmeh (Engineering Manager), LinkedIn</p>
<p>LinkedIn has hundreds of millions of members, and generating recommendations for who to follow is a challenging and data-intensive problem. The goal of this recommendation system is to recommend entities that a member will find interesting (that they&rsquo;ll actually follow the recommendations) and engaging (that they&rsquo;ll engage with the recommendations):</p>
<p><figure>
    <img src="follow_linkedin.png"/> 
</figure>
  </p>
<p>LinkedIn has over 690 million members; one immediate task is distinguishing between active members (who have done stuff on LinkedIn lately) and inactive members (who are either new, or registered but don&rsquo;t use the platform). They handle recommendations differently:</p>
<ul>
<li>for active users, create <em>personalized</em> recommendations based on offline, precomputed, member-level data (and real-time contextual recommendations)</li>
<li>for inactive users, where there&rsquo;s less data, create segment-based recommendations</li>
</ul>
<p>The rest of this talk focuses on the somethin</p>
<p>The scoring architecture looks like this:</p>
<p><figure>
    <img src="scoring_linkedin.png"/> 
</figure>
  </p>
<p>Their features include:</p>
<ul>
<li>(few) <strong>viewer features</strong>, like how often a user will click links on their feed, counts of impressions and interactions, segments like industry, company, skills, etc.</li>
<li>(moderate) <strong>entity features</strong>, like the follow-through and unfollow-through rates, feed click-through rates, etc.</li>
<li>(many) <strong>interaction features</strong>, like viewer/entity or segment/entity engagement, <a href="https://engineering.linkedin.com/recommender-systems/browsemap-collaborative-filtering-linkedin">browsemap scores</a>, embeddings, and <em>many</em> more</li>
</ul>
<p>Joining millions of active members to millions of entities results in <em>trillions</em> of interaction features; they apply a candidate selection feature that trims this down to &ldquo;just&rdquo; hundreds of billions of features. How does this happen?</p>
<h2 id="generating-these-features">Generating these features</h2>
<p><strong>(1)</strong>: the naive option is a <em>3 way Spark join</em>, first on viewerID then on entityID, would be awful; that&rsquo;d result in two gigantic shuffles of hundreds of terabytes of data while also being highly skewed. This won&rsquo;t work.</p>
<p><strong>(2)</strong>: another option is <em>partial scoring</em> using a linear model. Instead of joining all the features together, partially score viewer, entity, and pair features offline, then join the tables of <em>scores</em> instead of the tables of features.</p>
<p>This three-way join is more manageable, but it still has disadvantages; the scoring overhead isn&rsquo;t great, and there are intermediary steps that they&rsquo;d like to avoid. You also are forced to score with a linear model (since they&rsquo;re doing partial scoring on each of viewer, entity, and pair), which is a huge constraint apparently.</p>
<p><strong>(3)</strong>: the bottlenecks above were the large / wide table of pair features and the skewed entity distribution. They developed a <strong>2D hash-partitioned join</strong> for this:</p>
<p><figure>
    <img src="hash_partition_2d_linkedin.png"/> 
</figure>
  </p>
<p>Interesting&mdash;I don&rsquo;t fully understand this, but I think this <a href="https://engineering.linkedin.com/blog/2017/06/managing--exploding--big-data">blog post</a> talks about it in more depth. For a (viewer v, entity e), the viewer will be partitioned into <code>h(v) % V</code> and the entity <code>e(v) % E</code>, putting the pair into <code>h(v) % V*E + h(e) % E</code>, I think.</p>
<p>To do the join, they launch a mapper for each of (V x E) pair partitions, then load the entity partition into memory and the viewer partition into a stream reader. They go through each and merge the three features together, <em>score immediately</em>, and store it to HDFS. Because they score the merged record immediately, they can use a nonlinear model (they use XGBoost), too.</p>
<p>This improved cost by 5x, reduced storage of intermediate outputs by 8x, and (due to the use of XGBoost) improved interest and engagement by 11% and 17% (I think&mdash;slide moved away).</p>
<p><strong>Closing thoughts</strong>: this was another awesome talk! The slides were incredibly well-designed, and I considered including even more screenshots in this post. The speaker Emilie de Longueau was fantastic and explained this complex topic in an accessible way. The talk went into enough depth to be interesting, but not so much that it lost me.</p>
    </div>
    <div class="article-footer">
    </div>
  </article>
</div><nav class="bar bar-footer clearfix" data-stick-bottom>
    <div class="bar-inner">
        <ul class="pager pull-left">
            <li class="prev">
                <a href="/spark/2020/generalized_seir_models.html" title="Generalized SEIR Model On Large Networks"><i
                        class="icon icon-angle-left"
                        aria-hidden="true"></i><span>&nbsp;&nbsp;Older</span></a>
            </li>
            <li class="next">
                <a href="/spark/2020/census_differential_privacy.html"
                    title="Using Apache Spark And Differential Privacy For Protecting The Privacy Of The 2020 Census Respondents"><span>Newer&nbsp;&nbsp;</span><i
                        class="icon icon-angle-right" aria-hidden="true"></i></a>
            </li>
        </ul>
    </div>
</nav>


</main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
<ul class="social-links">
    <li><a href="https://github.com/tuchandra" target="_blank" title="github" data-toggle=tooltip data-placement=top >
            <i class="icon icon-github"></i></a></li>
    <li><a href="https://www.linkedin.com/in/tushar-chandra-76a623b6/" target="_blank" title="linkedin" data-toggle=tooltip data-placement=top >
            <i class="icon icon-linkedin"></i></a></li>
    <li><a href="/index.xml" target="_blank" title="rss" data-toggle=tooltip data-placement=top >
            <i class="icon icon-rss"></i></a></li>
</ul>
  <div class="copyright">
    &copy; 2019 - 2020 Tushar Chandra
    <p style="margin-bottom: 4px">All opinions are my own.</p>
    <div class="publishby">
        Theme: <a href="https://github.com/xiaoheiAh/hugo-theme-pure" target="_blank">Hugo Pure</a>.
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
            showMathMenu: false, //disables context menu
            tex2jax: {
            inlineMath: [ ['$','$'], ['\\(','\\)'] ]
           }
    });
</script>


<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/highlight.min.js"></script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/languages/python.min.js"></script><script>
    hljs.configure({
        tabReplace: '    ', 
        classPrefix: ''     
        
    })
    hljs.initHighlightingOnLoad();
</script>

  </body>
</html>
